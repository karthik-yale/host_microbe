# Host-associated microbiomes [![DOI](https://zenodo.org/badge/779341505.svg)](https://doi.org/10.5281/zenodo.13998699)

A key step towards rational microbiome engineering is the in silico sampling of realistic microbial communities that correspond to desired host phenotypes, and vice versa. This remains challenging due to a lack of generative models that simultaneously model compositions of host-associated microbiomes and host phenotypes. To that end, we present a machine learning model based on the consumer/resource (C/R) framework. In the model, variation in microbial ecosystem composition arises due to differences in the availability of effective resources (latent variables) while species’ resource preferences remain conserved. Variation in the same latent variables is used to model phenotypic variation across hosts. In silico microbiomes generated by our model accurately reproduce universal and dataset-specific statistics of bacterial communities. The model allows us to address two salient questions in microbiome design: (1) which host phenotypes maximally constrain the composition of the host-associated microbiome? and (2) what are plausible microbiome compositions corresponding to user-specified host phenotypes? Thus, our model aids the design and analysis of microbial communities associated with host phenotypes of interest.

## Table of Contents
- [Introduction](#introduction)
- [Repository Structure](#repository-structure)
- [Installation](#installation)
- [Usage](#usage)
- [License](#license)
- [Contact](#contact)

## Introduction

In this repository we have all the code and data that were used to analyze the data and produce all the figures in this [paper](https://doi.org/10.1101/2023.04.28.538625)

## Repository structure

```
host_microbe/
│
├── gradientDescent.py        # Class to fit the latent variable model (LVM) to microbiomes
├── gradientDescentMeta.py    # Class to fit the LVM to microbiomes and a linear model to metadata simultaneously
├── phenotype_constraint.py   # Class used for additional analyses
├── calc_local_cov.py         # Calculates personalized microbiome covariances for fig_4.ipynb
├── fig_1.ipynb               # Jupyter notebook for analysing low dimensionality
├── fig_2.ipynb               # Jupyter notebook to check accuracy of generative capacity of the LVM
├── fig_3.ipynb               # Jupyter notebook to identify phenotypes that constrain microbiome
├── fig_4.ipynb               # Jupyter notebook to quantify context-specificity in host-microbiome associations
├── fig_5.ipynb               # Jupyter notebook to design microbiomes for desired phenotypic states
├── data_files/               # Directory containing all data files
│   └── ...                   
├── environment.yml           # Conda environment configuration file
├── README.md                 # Project overview and instructions (this file)
└── LICENSE                   # License information for the repository
```

### Prerequisites

- Conda: Ensure you have Conda installed.
- **[Git LFS](https://git-lfs.github.com/)**: This repository uses Git Large File Storage

## Installation

- To install git lfs, run
        
        git lfs install

- If you have trouble installing git lfs, that step can be skipped and the large files, 'data_files/all_phens_covs.json' and 'data_files/my_object.pkl', can be downloaded manually
- To run the code in this repository, you need to set up the correct Python environment. This can be done using the environment.yml file provided.

### Setting Up the Environment

1. Clone the repository:

        git clone https://github.com/karthik-yale/host_microbe.git
        cd host_microbe

2. Create a new conda environment using the environment.yml file:

        conda env create -f environment.yml

3. Activate the newly created environment:

        conda activate host_microbe

4. Verify the installation:

        python -m pip check

This ensures that all dependencies have been correctly installed.

## Usage

The main analyses and figures in this repository are generated using Jupyter notebooks. Each notebook is self-contained and designed to guide you step by step through the analysis process.

### Running the Jupyter Notebooks

1. Activate the Environment:

        conda activate host_microbe

2. Launch Jupyter Notebook:

        jupyter notebook

3. Open the Notebooks:

    Navigate to the notebook you want to run (e.g., fig_1.ipynb), and open it in your browser.

4. Execute the Cells:

    Work through each notebook by executing the cells in sequence. The notebooks will call the necessary Python scripts and perform the analysis for you.

5. Output:

    The notebooks are designed to generate and display the figures directly in the notebook, as well as any results or outputs from the analysis.

### Recommended Workflow

Start with the first notebook (figure1_analysis.ipynb) and proceed through the notebooks in the order they are provided.
Each notebook builds on the previous one and will guide you through the analysis steps required to replicate the figures in the paper.


## License

This project is licensed under the [Apache License 2.0](LICENSE). 

### Summary

- You are free to use, distribute, and modify the code under the terms of the Apache License 2.0.
- Provides an explicit grant of patent rights.
- Requires attribution to the original author.

## Contact

For questions, comments, or inquiries about this project, please reach out to:

- **Primary Contact**: Karthik Srinivasan
  - **Email**: karthik.srinivasan@yale.edu

Feel free to open an issue on the host_microbe repository (https://github.com/karthik-yale/host_microbe) if you encounter any bugs or have suggestions for improvement.
